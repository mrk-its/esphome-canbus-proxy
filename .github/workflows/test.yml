name: "Test"

on: [push, pull_request]

jobs:
  build:
    name: ${{ matrix.board }} ${{ matrix.framework_opts }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      max-parallel: 2
      matrix:
        framework_opts:
          - "type=esp-idf version=recommended platform_version=5.4.0"
        board:
          - esp32-c3-devkitm-1
          - esp32-s3-devkitm-1
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Configure
        run: ${{matrix.framework_opts}} board=${{matrix.board}} envsubst < test/config.yaml.template > test/config.yaml
      - name: Compile
        uses: esphome/build-action@v4.0.4
        id: esphome-build
        with:
          yaml-file: test/config.yaml
